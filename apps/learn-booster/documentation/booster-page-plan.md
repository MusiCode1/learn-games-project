# מסמך תכנון – "מחזק" כאתר חיצוני

## 1. מטרות ותרחיש שימוש
- לאחר הצלחה במשימה באתר ג'ינג'ים מוצג לתלמיד דף אינטרנט חיצוני (משחק אהוב עליו).
- המורה מגדיר מראש את כתובת האתר עבור כל משימה/כיתה.
- הצגת הדף נועדה לחגוג הצלחה ולתת הפסקה חיובית, לא להתמודד עם כישלון.

## 2. תהליך למורה
- ממשק ניהול (קיים/חדש) מאפשר להזין URL גלובלי למחזק (תלמיד יקבל אותו אחרי כל משימה שהוגדרה להציג מחזק).
- אין צורך בסינון דומיינים או sandbox; האתר המוטמע נטען כמות שהוא גם אם ה-URL הוא HTTP.
- כתובת המחזק נשמרת כחלק מהקונפיגורציה הראשית (`Config`) ונשמרת בפרופילים.

## 3. חוויית תלמיד
- לאחר השלמת משימה בהצלחה, מופיעה שכבת "מחזק" עם iframe לכתובת שהוגדרה.
- ה־iframe נשמר בזיכרון ומוסתר בלבד כשהמחזק נסגר, כדי לשמור על הסטייט (כמו במנגנון הווידאו).
- משתכלל כפתור לחזרה למשחק, וכפתור אפשרי להמשך צפייה/עצירה.

## 4. דרישות פונקציונליות
- הצגת iframe עם אפשרות להגדיר גודל מגיב (responsive).
- מניעת טעינה מחדש בין הצגות חוזרות: יצירת iframe אחת שמתווספת ל-DOM בהפסקה הראשונה ונשארת.
- שליטה בתזמון הצגה: רק לאחר אירוע הצלחה מסוג מסוים (`game-handler.ts` מזהה ומפעיל).
- אפשרות ביטול מהמורה (למשל אם אין URL מוגדר – דילוג).

## 5. שיקולים טכניים
- עטיפת iframe במעטפת דומה ל-video overlay, כולל אנימציות כניסה/יציאה ושימוש ב-CSS קיים ככל האפשר.
- ניהול סטייט: אחסון מופע iframe במודול גלובלי (`video-loader.ts` כבסיס) כדי לשמר את התוכן בין הצגות.
- תמיכה בטעינת HTTP בתוך HTTPS (Fully מאפשר זאת); אין צורך ב-sandbox/whitelist.
- טיפול בשגיאות טעינה (onerror): להציג הודעה אם האתר לא זמין; אין איסוף סטטיסטיקות שימוש.

## 6. אינטגרציה בקוד
- `main.ts`: הוספת פעולה חדשה ב-GingimBoosterTools שמביאה את המחזק ומציגה אותו למורה (לצורכי בדיקה).
- `game-handler.ts`: זיהוי אירוע השלמת משימה → קריאה לפונקציית `showBoosterSite(url)`.
- מודול חדש `src/lib/booster-site.ts`:
  - אחסון singleton של iframe.
  - פונקציות `initBoosterSite(url)`, `showBoosterSite()`, `hideBoosterSite()`.
  - שימוש ב-CSS ל-positioning ומעברים.
- עדכון קובצי קונפיג: הוספת נתוני URL, תיעוד בקובץ `documentation/הגדרות-שצריך-לקבוע.md`.

## 7. צעדי פיתוח מוצעים
1. להחליט היכן נשמרות כתובות האתרים והאם יש ממשק להזנתן בזמן ריצה.
2. לממש מודול iframe קבוע (כולל CSS תומך) ולהתחבר ללוגיקת ההצגה הקיימת.
3. להרחיב את זרימת המשחק כך שאחרי הצלחה תופיע הקריאה לדף.
4. להוסיף מנגנון fallback (למשל הצגת הודעה) אם אין URL או אם הטעינה נכשלה.
5. להוסיף לוגיקת ניקוי/איפוס במידה וצריך להחליף URL בין משימות שונות.

- תרחיש הצלחה עם URL → iframe נטען ונשמר בין סגירות.
- תרחיש ללא URL מוגדר → אין הצגה, המשחק ממשיך רגיל.
- עדכון כתובת בזמן ריצה → iframe מתעדכן וממשיך לשמור סטייט אם הכתובת זהה, מאופס אם הוחלפה.
- בדיקות רספונסיביות (מסכים קטנים, טאבלט).
- בדיקת טעינה של דפי HTTP בתוך HTTPS בסביבות היעד (כולל Poly).

## 9. שאלות פתוחות
- האם יש צורך באיפוס iframe בעת שינוי ה-URL (או שמירה על היסטוריה קודמת)?
- כיצד מטפלים בהודעת שגיאה במקרה של טעינה נכשלת (באנר? הודעה למורה)?
- האם יש מגבלת זמן להצגת המחזק או שנסגר ידנית בלבד?

## 10. תכנון מימוש טכני
### 10.1 נתוני קונפיגורציה
- הרחבת טיפוס `Config` (ב-`src/types.ts`) בשדה חדש `booster: { siteUrl: string }`.
- עדכון `default-config.ts` כך שיכיל ערך ברירת מחדל (`siteUrl: ''`).
- הקונפיג נשמר ומנוהל דרך `config-manager.ts`, ולכן אין צורך בהרחבת `game-config.ts`.
- הוספת שדה למחזק בממשקי ניהול הקונפיג (טפסים/פרופילים) כדי שמורה יוכל להזין URL.
- תיעוד השדה החדש ב-`documentation/הגדרות-שצריך-לקבוע.md`.

### 10.2 מודול iframe חדש (`src/lib/booster-site.ts`)
- שמירת מופע iframe ו-overlay כ-singleton ברמה מודולרית (בדומה ל-`video-loader`).
- ממשק מוצע:
  - `ensureBoosterSite(appendRoot: HTMLElement): void` – יוצר את המבנה אם אינו קיים ומוסיף ל-DOM.
  - `setBoosterUrl(url: string): void` – מעדכן `src`, שולח `about:blank` במקרה ריק, ומזהה שינוי URL כדי לבצע reset אם חייבים.
  - `showBoosterSite(): void` / `hideBoosterSite(): void` – שליטה בהצגה באמצעות מחלקות CSS.
- טיפול באירועי `load`/`error`, חשיפת callbacks אופציונליים עבור UI (למשל מצבי טעינה).
- שימוש ב-CSS קיימים לאנימציות אם אפשר, אחרת להוסיף קובץ `booster-site.css`.

- `config-manager.ts`:
  - לעדכן `updateConfig`/`tempConfig` כך שעבודה עם השדה החדש תמשיך לעבוד (ה-`deepMerge` כבר תומך, אך רצוי להוסיף טיפוס).
  - לחשוף getter ייעודי אם צריך (למשל `getBoosterSiteUrl()`), או להשתמש ישירות ב-`getAllConfig`.

### 10.3 שילוב בלוגיקת המשחק
- `game-handler.ts`: עם אירוע הצלחה (כפי שמזוהה היום), לקבל את `booster.siteUrl` מהקונפיג הנוכחי:
  - אם `siteUrl` לא ריק → `ensureBoosterSite(root)` (פעם אחת), `setBoosterUrl(siteUrl)`, ואז `showBoosterSite()`.
  - אם ריק → לא לעשות דבר.
- וידוא שההצגה מתרחשת אחרי תום האנימציות של המשחק; להיעזר בלוגיקה קיימת להצגת וידאו אם צריך (אותו טריגר).
- סגירה אוטומטית בסיום הטיימר הקיים או עם האירוע המתאים (shared logic עם הווידאו אם קיים).

- `main.ts`: הוספת גישה דרך GingimBoosterTools שמזמינה את המחזק ידנית (לבדיקה ידנית של מורים/מפתחים).
- אם יש UI להזנת ההגדרות בתוך האפליקציה, להוסיף שדה לטופס (בהסתמך על קבצים רלוונטיים).

### 10.4 סגנונות (CSS/SCSS)
- יצירת קובץ סגנונות ייעודי (למשל `src/styles/booster-site.css`) או הרחבת קובץ קיים.
- overlay במיקום `fixed` עם ז-אינדקס גבוה, רקע שקוף למחצה וגרסת מובייל.
- iframe מוצמד לגודל יחסי (`width: 80vw; height: 80vh;` ברירת מחדל, התאמות מובייל).
- כפתורי סגירה/חזרה ממוקמים באופן עקבי עם שכבת הווידאו.

### 10.5 טיפול בשגיאות וחוויית משתמש
- `setBoosterUrl('')` → הסתרה (אין מחזק); שמירה על iframe קיים אך ללא src.
- אירוע `error` → החלפת התוכן בתצוגת fallback (טקסט קצר וכפתור "חזרה למשחק").
- אין דרישה לחזרה מוקדמת מצד התלמיד, אך `hideBoosterSite` נשאר זמין לשימוש עתידי ולכפתור סגירה.

### 10.6 בדיקות
- בדיקת יחידה ל`config-manager`/`default-config` לוודא שהשדה החדש נטען ונשמר (כולל פרופילים).
- בדיקות אינטגרציה/ידניות לתרחישי טעינה, שינוי URL, ותצוגה במכשירים שונים.
- בדיקת תאימות Fully (טען דף HTTP בתוך HTTPS).
