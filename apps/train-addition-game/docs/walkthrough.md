# יומן פיתוח - רכבת החיבור

## 2025-12-24 19:30

### סידור מבנה קומפוננטות (Co-location)

בוצע ארגון מחדש של מבנה הקומפוננטות בהתאם לעיקרון Co-location - מיקום קומפוננטות ייחודיות לדף בתוך תיקיית `_components`.

#### מה בוצע?

**1. העברת קומפוננטות**

- 8 קומפוננטות הועברו מ-`src/lib/components` ל-`src/routes/game/_components`:
  `GameWorld`, `TrainTrackArea`, `TrainCar`, `AnswerPanel`, `DepotArea`, `FeedbackOverlay`, `InstructionPanel`, `CounterBadge`
- `SettingsControls` הועבר ל-`src/routes/settings/_components`
- נשאר רק `HeaderBar` ב-`src/lib/components` (משותף)

**2. עדכון imports**

- עודכנו כל ה-imports בדפי +page.svelte לנתיבים יחסיים

#### החלטות ארכיטקטורה

- **בחירה בתיקיית `_components`**: נבחר להשתמש בתיקייה מקוננת (`_components`) ולא שטוחה כי יש 8 קומפוננטות, וזה שומר על הראוט נקי וברור.

---

## 2025-12-22 14:50

### הושלמה גרסה v0.5 - ניהול הגדרות ומצבי משחק

הושלם מהלך נרחב של שדרוג תשתית ההגדרות והוספת מצבי משחק חדשים.

#### מה בוצע?

**1. ניהול הגדרות וממשק משתמש**

- נוצר דף הגדרות ייעודי (`/settings`) המחליף את ה-Overlay הישן.
- פותח רכיב `SettingsControls` המאחד את כל הגדרות המשחק והבוסטר במקום אחד.
- הוספה יכולת גלילה לדף ההגדרות לתמיכה במסכים קטנים.
- עודכן ה-`HeaderBar` לניווט ישיר לדף ההגדרות.

**2. לוגיקת משחק (Game Logic)**

- נוספו שני מצבי משחק חדשים:
  - **רציף (Continuous):** מעבר אוטומטי לחיזוק ולשלב הבא ללא התערבות.
  - **ידני (Manual End):** עצירה בסיום שלב והצגת כפתור "שחק שוב".
- תוקן באג בו הבוסטר לא הופעל אוטומטית במצב רציף.
- עודכנה מכונת המצבים (`GameState`) לתמיכה ב-`LEVEL_END`.

**3. תשתית ובדיקות**

- שודרג ה-`SettingsStore` לשמירת מצבי משחק ומיגרציה מגרסאות קודמות.
- נכתבו בדיקות E2E חדשות (`settings.spec.ts`, `game.spec.ts`) המכסות:
  - ניווט ושינוי הגדרות.
  - זרימת משחק מלאה בשני המצבים.
  - תיקוני באגים וגלילה.

---

## 20/12/2025 03:25

### 🧪 הקמת מערך בדיקות מקיף (Vitest + Playwright)

נוספה תשתית בדיקות מלאה לפרויקט, המכסה הן את הלוגיקה העסקית והן את חווית המשתמש והרספונסיביות.

#### מה בוצע?

**1. בדיקות יחידה (Unit Tests) - Vitest**

- **כיסוי:** `src/tests/unit/gameState.test.ts`
- **תוכן:** אימות הלוגיקה של `game-state.svelte.ts`:
  - אתחול משחק תקין.
  - מעברים בין שלבים (`BUILD_A` -> `ADD_B` -> `CHOOSE_ANSWER`).
  - טיפול נכון בתשובות (ניקוד חיובי vs ענישה/Cooldown).

**2. בדיקות קצה-לקצה (E2E) - Playwright**

- **כיסוי:** `src/tests/e2e/game.spec.ts`
- **Happy Path:** הרצת סיבוב משחק מלא (הוספת קרונות, מענה נכון).
- **תרחישי שגיאה:** וידוא הופעת משוב שגיאה (Overlay כתום) בעת טעות.
- **רספונסיביות:** בדיקה שהאלמנטים הקריטיים (כמו רכבת ופאנל תשובות) מוצגים כראוי ב-Mobile (320px) וב-Desktop.

## 20/12/2025 01:40

### 🚂 עיצוב רספונסיבי וליטוש חווית משתמש (Responsive Design Polish)

בוצעו התאמות מקיפות לוודא שהמשחק נראה ועובד מצוין בכל גודל מסך, עם דגש מיוחד על הצמדת הרכבת לקרקע ותמיכה במכשירים קטנים.

#### מה בוצע?

**1. ממשק ורספונסיביות**

- **עיגון הרכבת:** הרכבת כעת "יושבת" באופן אבסולוטי בתחתית המסך, ללא תלות באלמנטים אחרים, מה שמבטיח שהיא תמיד על הדשא ולא "מרחפת".
- **חיתוך קרקע חכם:** במסכים קטנים (Mobile), גובה הקרקע צומצם משמעותית ושכבת האדמה הוסתרה כדי לחסוך מקום יקר.
- **מצב קומפקטי (Compact Mode):** מסכים צרים (עד 320px) מציגים כעת גרסה מוקטנת של פאנל התשובות והוראות המשחק.
- **הסתרת בועות:** במובייל, בזמן שלב המענה ("כמה קרונות?"), בועות החישוב של השלב הקודם מוסתרות כדי למנוע עומס וחפיפה.
- **תיקון Feedback Overlay:** שכבת המשוב הועברה ל-Root של הדף ותוקנה בעיית Z-Index שמנעה את הופעתה במובייל.

**2. רכיבים**

- **AnswerPanel:** תצוגה דינמית המשתנה משורה אחת (Desktop) לשתי שורות (Mobile) באופן אוטומטי.
- **TrainTrackArea:** הקטנת גודל האלמנטים (בועות מספר, קרונות) במובייל למניעת גלישה.

## 18/12/2025 17:40

### 🧪 עיצוב מחדש של ה-UI, ארגון Router ושיפורי יציבות

בוצע שדרוג מקיף לחווית המשתמש ולמבנה האפליקציה, במטרה ליצור חוויה יציבה יותר ומונגשת.

#### מה בוצע?

**1. ממשק משתמש (UI/UX)**

- **יציבות תצוגה (Layout Stability):** הטמעת מנגנון "פלייסהולדרים" (באמצעות `invisible`) לרכיבים מרכזיים כמו `AnswerPanel`, כדי למנוע קפיצות במסך בעת שינויי מצב משחק.
- **וידג'ט התקדמות:** הוזז לראש המסך (במרכז), בתצורה אופקית, כדי לא להסתיר אלמנטים.
- **כפתורים ושליטה:**
  - כפתור "הוסף קרון" (Depot) מופיע בנפרד רק כשרלוונטי.
  - כפתור "השמע" עגול ומינימליסטי יותר.
  - כפתור "הגדרות" ו-"בית" בעיצוב חדש עם אייקונים.
- **פאנל תשובות:** תצוגת Grid (2 שורות של 5) במסכים צרים לשיפור הנוחות.
- **טיפול בגלילה:** הגדרת `h-screen` וצמצום מרווחים למניעת גלילה מיותרת.

**2. ארכיטקטורה (Routing)**

- **פיצול עמודים:**
  - `src/routes/+page.svelte` - מסך פתיחה ("לובי") בלבד.
  - `src/routes/game/+page.svelte` - מסך המשחק הראשי.
- **Layout משותף:**
  - `src/routes/+layout.svelte` מכיל כעת את האלמנטים הקבועים: רקע (עננים), Header Bar, ו-Settings Overlay.

**3. רכיבים וקוד**

- **סנכרון סאונד:** מעבר ל-`async/await` ומנגנון Promise להשמעת TTS/Audio למניעת חפיפות.
- **ניקוי:** הסרת `AssistOverlay` (פופאפ עזרה) שהפריע, והסרת טקסטים כפולים.
- **דיבאג:** הוספת `window.GameDebug` לבדיקות קלות בקונסול.

## 17/12/2025 - יצירת הפרויקט

### 🚀 מה נוצר

**תשתית**

- אפליקציית SvelteKit עם Tailwind CSS ו-TypeScript

**לוגיקה**

- `game-state.svelte.ts` - State Machine
- `settings.svelte.ts` - הגדרות מורה
- `tts.ts` - הקראה עם fallback ל-TTS
- `distractors.ts` - יצירת מסיחים

**רכיבי UI**

- TrainCar, TrainTrackArea, DepotArea
- HeaderBar, InstructionPanel, AnswerPanel
- CounterBadge, FeedbackOverlay, AssistOverlay

**קבצים סטטיים**

- SVG: locomotive, car-green, car-blue
- סאונד: 13 קבצי WAV

### ✨ תכונות

- cooldown 10 שניות עם טיימר
- מספרים דינמיים + סימן חיבור
- ספרות 1-10 לבחירה
- אנימציות מושכות
